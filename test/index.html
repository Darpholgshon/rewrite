<html>
  <head>
    <title>rewrite tests</title>
    <script src="static/jquery.js"></script>
    <link rel="stylesheet" 
      href="static/qunit.css" type="text/css" media="screen" />
    <script type="text/javascript"
      src="static/qunit.js"></script>
    <script type="text/javascript"
      src="static/rewrite-tests.js"></script>
    <script>
    $(document).ready(function(){
      module("root") ;
      asyncTest("simple root", function() {
        $.ajax( {
          url: rewriteUrl( 'GET', '/', '<root>server#ping</root>', '' )
        , success:  function(d,t,j) { 
          equals( d, '/resource/server.xqy?action=ping', "OK" );
           }
        , error:    function(j,t,e) { ok(false, "NOK") }
        , complete: function()      { start(); } }) }) ;
      asyncTest("shouldn't match root", function() {
        $.ajax( {
          url: rewriteUrl( 'GET', '/foo.jpg', '<root>server#ping</root>', '' )
        , success:  function(d,t,j) { 
          equals( d, '/static/foo.jpg', "OK" );
           }
        , error:    function(j,t,e) { ok(false, "NOK") }
        , complete: function()      { start(); } }) }) ;
      module("paths") ;
      asyncTest("Change resource directory to /controller/", function() {
        $.ajax( {
          url: rewriteUrl( 'GET', '/', '<root>server#ping</root>', '',
          '<resourceDirectory>/controller/</resourceDirectory>' )
        , success:  function(d,t,j) { 
          equals( d, '/controller/server.xqy?action=ping', "OK" );
           }
        , error:    function(j,t,e) { ok(false, "NOK") }
        , complete: function()      { start(); } }) }) ;
      asyncTest("Change resource directory to /", function() {
        $.ajax( {
          url: rewriteUrl( 'GET', '/', '<root>server#ping</root>', '',
          '<resourceDirectory>/</resourceDirectory>' )
        , success:  function(d,t,j) { 
          equals( d, '/server.xqy?action=ping', "OK" );
           }
        , error:    function(j,t,e) { ok(false, "NOK") }
        , complete: function()      { start(); } }) }) ;
      asyncTest("Change resource directory to ()", function() {
        $.ajax( {
          url: rewriteUrl( 'GET', '/', '<root>server#ping</root>', '',
          '<resourceDirectory/>' )
        , success:  function(d,t,j) { 
          equals( d, 'server.xqy?action=ping', "OK" );
           }
        , error:    function(j,t,e) { ok(false, "NOK") }
        , complete: function()      { start(); } }) }) ;
      asyncTest("Change extension to .xq", function() {
         $.ajax( {
           url: rewriteUrl( 'GET', '/', '<root>server#ping</root>', '',
           '<xqyExtension>xq</xqyExtension>' )
         , success:  function(d,t,j) { 
           equals( d, '/resource/server.xq?action=ping', "OK" );
            }
         , error:    function(j,t,e) { ok(false, "NOK") }
         , complete: function()      { start(); } }) }) ;
      asyncTest("Change static to /public/", function() {
         $.ajax( {
           url: rewriteUrl( 'GET', '/css/style.css', 
             '<root>server#ping</root>', '',
             '<staticDirectory>/public/</staticDirectory>' )
         , success:  function(d,t,j) { 
           equals( d, '/public/css/style.css', "OK" );
            }
         , error:    function(j,t,e) { ok(false, "NOK") }
         , complete: function()      { start(); } }) }) ;
    }) ;

    </script>
  </head>
  <body>
    <h1 id="qunit-header">rewrite tests</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture">test markup, will be hidden</div>
  </body>
</html>